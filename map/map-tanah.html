<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Peta Dunia - Kamera Miring (Pinch Zoom)</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100%;
    background: #162d19;
  }
  canvas {
    display: block;
    cursor: grab;
    touch-action: none; /* penting agar gestur pinch & drag bekerja */
  }
</style>
</head>
<body>
<canvas id="map"></canvas>

<script>
// === SETUP DASAR ===
const canvas = document.getElementById("map");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const mapSize = 12000;
let camX = mapSize/2 - window.innerWidth/2;
let camY = mapSize/2 - window.innerHeight/2;
let scale = 1;

// === GENERATOR WARNA ===
function noise(x, y) {
  return Math.sin(x*0.0012 + Math.cos(y*0.0008)) * 0.5 +
         Math.sin(x*0.0003 - y*0.001) * 0.5;
}
function generateColor(x, y) {
  const n = noise(x, y);
  const h = (n + 1) / 2;
  const riverPattern =
    Math.sin(y * 0.00035 + Math.cos(x * 0.00025)) +
    Math.sin((x + 2000) * 0.0002) * 0.6 +
    Math.cos((y - 5000) * 0.0002) * 0.4;
  const riverDist = Math.abs(riverPattern);
  const riverStrength = Math.max(0, 0.25 - riverDist);
  if (riverStrength > 0.02) {
    const deep = 180 - riverStrength*300;
    return `rgb(${deep*0.3}, ${deep*0.6}, ${deep})`;
  }
  const lakeSeed = Math.sin(x*0.0004)*Math.cos(y*0.0004);
  if (lakeSeed > 0.94) return `rgb(30,100,160)`;
  if (h < 0.4) {
    const g = 60 + h*120;
    return `rgb(${g*0.5},${g},${g*0.5})`;
  }
  if (h < 0.7) {
    const g = 70 + h*100;
    return `rgb(${g*0.4},${g*0.8},${g*0.4})`;
  }
  const grey = 100 + h*100;
  return `rgb(${grey},${grey*0.9},${grey*0.8})`;
}

// === BUAT GAMBAR MAP BESAR ===
const offCanvas = document.createElement("canvas");
offCanvas.width = mapSize;
offCanvas.height = mapSize;
const offCtx = offCanvas.getContext("2d");
const img = offCtx.createImageData(mapSize, mapSize);
for (let y=0; y<mapSize; y++) {
  for (let x=0; x<mapSize; x++) {
    const color = generateColor(x, y);
    const [r,g,b] = color.match(/\d+/g).map(Number);
    const i = (y*mapSize+x)*4;
    img.data[i]=r; img.data[i+1]=g; img.data[i+2]=b; img.data[i+3]=255;
  }
}
offCtx.putImageData(img,0,0);

// === FUNGSI GAMBAR ===
function draw() {
  ctx.setTransform(scale, 0, 0, scale, -camX*scale, -camY*scale);
  ctx.imageSmoothingEnabled = true;
  ctx.save();
  const tilt = 0.5;
  ctx.transform(1, -tilt, 0, 1, 0, 0);
  ctx.drawImage(offCanvas, 0, 0);
  const grad = ctx.createLinearGradient(0, 0, 0, mapSize);
  grad.addColorStop(0, "rgba(0,0,0,0.4)");
  grad.addColorStop(0.5, "rgba(0,0,0,0.1)");
  grad.addColorStop(1, "rgba(0,0,0,0)");
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, mapSize, mapSize);
  ctx.restore();
}
draw();

// === DRAG DENGAN SATU JARI / MOUSE ===
let dragging=false,lastX,lastY;
canvas.addEventListener("mousedown",e=>{
  dragging=true; lastX=e.clientX; lastY=e.clientY; canvas.style.cursor="grabbing";
});
window.addEventListener("mouseup",()=>{dragging=false; canvas.style.cursor="grab";});
window.addEventListener("mousemove",e=>{
  if(!dragging)return;
  camX -= (e.clientX-lastX)/scale;
  camY -= (e.clientY-lastY)/scale;
  lastX=e.clientX; lastY=e.clientY;
  draw();
});

// === GESTUR PINCH ZOOM (dua jari) ===
let lastDist = null;
canvas.addEventListener("touchstart", e => {
  if (e.touches.length === 2) {
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    lastDist = Math.hypot(dx, dy);
  }
  if (e.touches.length === 1) {
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  }
});
canvas.addEventListener("touchmove", e => {
  e.preventDefault();
  // geser satu jari
  if (e.touches.length === 1 && lastX !== null) {
    const dx = e.touches[0].clientX - lastX;
    const dy = e.touches[0].clientY - lastY;
    camX -= dx / scale;
    camY -= dy / scale;
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
    draw();
  }
  // pinch dua jari untuk zoom
  if (e.touches.length === 2) {
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const dist = Math.hypot(dx, dy);
    if (lastDist) {
      const zoom = dist / lastDist;
      scale *= zoom;
      scale = Math.max(0.2, Math.min(scale, 5));
      draw();
    }
    lastDist = dist;
  }
});
canvas.addEventListener("touchend", () => { lastDist = null; });

// === RESIZE ===
window.addEventListener("resize",()=>{
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
  draw();
});
</script>
</body>
</html>
